{
  "tool_id": "line_balance_calculator",
  "pre_process_code": "import json\nimport copy # Allowed module\n\ndef convert_bop_to_input(bop_json: dict, params: dict) -> str:\n    \"\"\"\n    Converts GDP BOP data into the Line Balance Calculator's input format.\n\n    Args:\n        bop_json (dict): The BOP data in GDP format.\n        params (dict): User-configurable parameters from the UI.\n\n    Returns:\n        str: A JSON string formatted for the Line Balance Calculator input.\n    \"\"\"\n    tool_input = {}\n\n    # 1. Extract and format `process_details` for the tool.\n    # The tool's `calculate_line_balance` function expects:\n    # `process_id`, `parallel_index`, `cycle_time_sec`, `name`.\n    extracted_process_details = []\n    for detail in bop_json.get(\"process_details\", []):\n        extracted_process_details.append({\n            \"process_id\": detail.get(\"process_id\", \"\"),\n            \"parallel_index\": detail.get(\"parallel_index\", 0), # Default to 0 as seen in tool example\n            \"cycle_time_sec\": detail.get(\"cycle_time_sec\", 0.0), # Default to 0.0 to prevent errors\n            \"name\": detail.get(\"name\", detail.get(\"process_id\", \"Unnamed Process\")) # Use process_id as fallback name\n        })\n    tool_input[\"process_details\"] = extracted_process_details\n\n    # 2. Extract `target_uph`.\n    # Prioritize BOP's target_uph. If not in BOP, check params.\n    # The tool has a default (60) if not provided, but we pass it explicitly if available.\n    tool_input[\"target_uph\"] = bop_json.get(\"target_uph\", params.get(\"target_uph\", 60))\n\n    # 3. CRITICAL: Include ALL user parameters from `params`.\n    # As per instructions, all user-configurable parameters must be passed to the tool,\n    # even if the tool's source code doesn't explicitly use them for its core logic.\n    # These will be merged at the top level of the tool input.\n    for key, value in params.items():\n        # Only add if not already explicitly set from BOP or a default derived from BOP.\n        # This prevents `params.get(\"target_uph\")` from overriding `bop_json.get(\"target_uph\")`\n        # if both are present, preserving BOP's priority.\n        if key not in tool_input:\n            tool_input[key] = value\n\n    return json.dumps(tool_input, ensure_ascii=False)\n",
  "post_process_code": "import json\nimport copy # Allowed module\n\ndef apply_result_to_bop(bop_json: dict, tool_output: dict) -> dict:\n    \"\"\"\n    Applies the results from the Line Balance Calculator back to the GDP BOP data.\n\n    Args:\n        bop_json (dict): The original BOP data in GDP format.\n        tool_output (dict): The parsed dictionary output from the Line Balance Calculator.\n                            CRITICAL: This is already a dict, NOT a JSON string.\n\n    Returns:\n        dict: The updated BOP data with analysis results.\n    \"\"\"\n    # Make a deep copy to ensure the original bop_json object is not mutated\n    # directly, allowing for a clean return of the updated structure.\n    updated_bop = copy.deepcopy(bop_json)\n\n    # The BOP schema provided does not have specific fields for line balance metrics.\n    # We will add a new top-level key, \"analysis_results\", to store these findings.\n    # This key will contain a sub-key for this specific tool's output.\n    if \"analysis_results\" not in updated_bop:\n        updated_bop[\"analysis_results\"] = {}\n\n    # Store the entire tool_output under a descriptive key within \"analysis_results\".\n    # This preserves all data returned by the tool without ambiguity about mapping.\n    updated_bop[\"analysis_results\"][\"line_balance_calculator\"] = tool_output\n\n    # \"CRITICAL â€” Parallel Instance Creation Rules\" are not applicable here.\n    # The Line Balance Calculator tool only provides analytical results and does not\n    # output new process_detail instances, modify existing ones (like location/size),\n    # or alter resource assignments. Therefore, no logic is needed to handle these rules\n    # for this specific tool's output.\n\n    return updated_bop\n",
  "model": "gemini-2.5-flash",
  "generated_at": "2026-02-15T14:46:55.320802"
}