{
  "tool_id": "process_distance_analyzer",
  "pre_process_code": "def convert_bop_to_input(bop_json: dict, params: dict) -> str:\n    \"\"\"\n    Converts BOP JSON data to the input format required by the Process Distance Analyzer tool.\n\n    Args:\n        bop_json (dict): The input BOP data.\n        params (dict): User-configurable parameters.\n\n    Returns:\n        str: A JSON string formatted for the tool.\n    \"\"\"\n    import json\n\n    tool_processes = []\n    tool_process_locations = []\n\n    # Map BOP processes (routing information) to tool's 'processes' field\n    for bop_proc in bop_json.get(\"processes\", []):\n        tool_processes.append({\n            \"process_id\": bop_proc.get(\"process_id\", \"\"),\n            \"predecessor_ids\": bop_proc.get(\"predecessor_ids\", []),\n            \"successor_ids\": bop_proc.get(\"successor_ids\", [])\n        })\n\n    # Map BOP process_details (location and name) to tool's 'process_locations' field.\n    # The tool expects one location per process_id. BOP can have multiple instances\n    # (parallel_index). We prioritize parallel_index=1 if available, otherwise pick\n    # the first encountered instance for each process_id.\n    process_details_map = {} # Maps process_id to its chosen detail entry\n    for detail in bop_json.get(\"process_details\", []):\n        pid = detail.get(\"process_id\")\n        if not pid:\n            continue\n\n        pidx = detail.get(\"parallel_index\", 1)\n\n        # If this process_id hasn't been mapped yet, or if this is the primary instance (parallel_index=1),\n        # store or update the map with this detail. This ensures parallel_index=1 takes precedence.\n        if pid not in process_details_map or pidx == 1:\n            process_details_map[pid] = detail\n    \n    # Convert the selected process details into the tool's 'process_locations' format\n    for pid, detail in process_details_map.items():\n        location = detail.get(\"location\", {})\n        tool_process_locations.append({\n            \"process_id\": pid,\n            \"x\": location.get(\"x\", 0.0),\n            \"y\": location.get(\"y\", 0.0),\n            \"z\": location.get(\"z\", 0.0),\n            \"name\": detail.get(\"name\", pid) # Fallback to process_id if name is missing\n        })\n\n    tool_input = {\n        \"processes\": tool_processes,\n        \"process_locations\": tool_process_locations\n    }\n\n    # IMPORTANT: The provided 'Process Distance Analyzer' tool source code only consumes\n    # 'processes' and 'process_locations' from its input JSON. It does not read any\n    # general 'params' from the input. Therefore, 'params' are not included in the\n    # 'tool_input' dictionary for this specific tool to avoid adding unused fields.\n\n    return json.dumps(tool_input, ensure_ascii=False)\n",
  "post_process_code": "def apply_result_to_bop(bop_json: dict, tool_output: dict) -> dict:\n    \"\"\"\n    Applies the results from the Process Distance Analyzer tool back to the BOP JSON.\n\n    Args:\n        bop_json (dict): The original BOP data.\n        tool_output (dict): The parsed output from the Process Distance Analyzer tool.\n                            (CRITICAL: This is already a dict, DO NOT json.loads() it).\n\n    Returns:\n        dict: The updated BOP data with analysis results.\n    \"\"\"\n    import copy\n\n    # Create a deep copy to ensure original bop_json is not modified if it's passed by reference\n    updated_bop = copy.deepcopy(bop_json)\n\n    # The BOP schema does not have direct fields for distance analysis results (e.g., 'distances',\n    # 'total_flow_distance_m', 'suggestions'). We will add a new top-level field to store these results.\n    analysis_results = {\n        \"distances\": tool_output.get(\"distances\", []),\n        \"total_flow_distance_m\": tool_output.get(\"total_flow_distance_m\", 0.0),\n        \"avg_distance_m\": tool_output.get(\"avg_distance_m\", 0.0),\n        \"max_distance_pair\": tool_output.get(\"max_distance_pair\"),\n        \"min_distance_pair\": tool_output.get(\"min_distance_pair\"),\n        \"distance_std_dev_m\": tool_output.get(\"distance_std_dev_m\", 0.0),\n        \"num_pairs\": tool_output.get(\"num_pairs\", 0),\n        \"suggestions\": tool_output.get(\"suggestions\", [])\n    }\n\n    # Add the analysis results under a new key in the BOP JSON. Choose a distinct key name.\n    updated_bop[\"distance_analysis_results\"] = analysis_results\n\n    # CRITICAL: The 'Process Distance Analyzer' tool's output does not include modifications\n    # to existing process locations or instructions to create new parallel instances.\n    # Therefore, the 'Parallel Instance Creation Rules' mentioned in the prompt are not\n    # applicable to this specific tool's integration. We are solely appending the analysis results.\n\n    return updated_bop\n",
  "model": "gemini-2.5-flash",
  "generated_at": "2026-02-15T14:48:44.518502"
}