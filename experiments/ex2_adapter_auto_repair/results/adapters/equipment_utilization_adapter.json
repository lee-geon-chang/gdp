{
  "tool_id": "equipment_utilization",
  "pre_process_code": "import json\nimport copy # Allowed stdlib module\n\ndef convert_bop_to_input(bop_json: dict, params: dict) -> str:\n    \"\"\"\n    Converts BOP JSON data into the input format required by the\n    Equipment Utilization Analyzer tool.\n\n    Args:\n        bop_json (dict): The input BOP JSON data.\n        params (dict): User-configurable parameters from the UI.\n\n    Returns:\n        str: A JSON string formatted for the Equipment Utilization Analyzer tool.\n    \"\"\"\n    \n    # 1. Extract equipments\n    equipments_for_tool = []\n    for eq in bop_json.get(\"equipments\", []):\n        equipments_for_tool.append({\n            \"equipment_id\": eq.get(\"equipment_id\", \"\"),\n            \"name\": eq.get(\"name\", eq.get(\"equipment_id\", \"Unnamed Equipment\")), \n            \"type\": eq.get(\"type\", \"unknown\")\n        })\n\n    # 2. Extract assignments, filtering for equipment only\n    assignments_for_tool = []\n    for res_assign in bop_json.get(\"resource_assignments\", []):\n        if res_assign.get(\"resource_type\") == \"equipment\":\n            assignments_for_tool.append({\n                \"process_id\": res_assign.get(\"process_id\", \"\"),\n                \"parallel_index\": res_assign.get(\"parallel_index\", 0), # Default to 0 as per tool source example for lookup keys\n                \"resource_type\": \"equipment\", \n                \"resource_id\": res_assign.get(\"resource_id\", \"\"),\n                \"role\": res_assign.get(\"role\", \"main\")\n            })\n\n    # 3. Extract process_times from process_details\n    process_times_for_tool = []\n    for proc_detail in bop_json.get(\"process_details\", []):\n        process_times_for_tool.append({\n            \"process_id\": proc_detail.get(\"process_id\", \"\"),\n            \"parallel_index\": proc_detail.get(\"parallel_index\", 0), # Default to 0 as per tool source example for lookup keys\n            \"cycle_time_sec\": proc_detail.get(\"cycle_time_sec\", 0.0)\n        })\n\n    # 4. Determine target_uph\n    # Use BOP's value if available, otherwise default to 60 as per tool's internal default.\n    # Per instructions, `params` are for values *not in BOP*. `target_uph` is defined in BOP.\n    target_uph = bop_json.get(\"target_uph\", 60)\n    \n    # Assemble the tool's input dictionary.\n    # Per the tool's source code and concrete input example, it strictly expects\n    # only the 'equipments', 'assignments', 'process_times', and 'target_uph' keys.\n    # Arbitrary parameters from the 'params' dict are not consumed by this specific tool.\n    tool_input = {\n        \"equipments\": equipments_for_tool,\n        \"assignments\": assignments_for_tool,\n        \"process_times\": process_times_for_tool,\n        \"target_uph\": target_uph\n    }\n\n    return json.dumps(tool_input, ensure_ascii=False)\n",
  "post_process_code": "import json\nimport copy # Allowed stdlib module\n\ndef apply_result_to_bop(bop_json: dict, tool_output: dict) -> dict:\n    \"\"\"\n    Applies the results from the Equipment Utilization Analyzer tool output\n    back into the BOP JSON structure.\n\n    This tool provides analytical results (utilization, suggestions) rather than\n    modifying existing physical properties like locations or sizes.\n    Therefore, the results are added under a new top-level key in the BOP.\n\n    Args:\n        bop_json (dict): The original BOP JSON data.\n        tool_output (dict): The already parsed dictionary output from the tool.\n\n    Returns:\n        dict: The updated BOP JSON data including the analysis results.\n    \"\"\"\n    # CRITICAL: tool_output is ALREADY PARSED as dict by the executor.\n    # DO NOT call json.loads(tool_output) - it will cause an error!\n\n    # Create a deep copy of the original BOP JSON to avoid modifying it directly\n    # and to preserve all existing fields that are not explicitly updated.\n    updated_bop = copy.deepcopy(bop_json)\n\n    # Add the entire tool output as a new top-level field in the BOP.\n    # This key stores all the analysis results, summary statistics, and suggestions.\n    updated_bop[\"equipment_utilization_analysis_results\"] = tool_output\n\n    return updated_bop\n",
  "model": "gemini-2.5-flash",
  "generated_at": "2026-02-15T14:38:56.263068"
}